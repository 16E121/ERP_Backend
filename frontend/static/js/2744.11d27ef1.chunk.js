"use strict";(self.webpackChunkerp=self.webpackChunkerp||[]).push([[2744],{64568:(e,s,a)=>{a.d(s,{c:()=>r});var t=a(82496);const r=()=>(0,t.jsx)("span",{style:{color:"red",fontWeight:"bold",fontSize:"1em"},children:" *"})},62344:(e,s,a)=>{a.d(s,{o$:()=>c,o5:()=>n,cF:()=>l,iI:()=>r});const t=a.p+"static/media/smt.aa4d4f940bbebff07a57.png",r={table:{style:{width:"auto",backgroundColor:"transparent"}},rows:{style:{backgroundColor:"transparent"}},headCells:{style:{backgroundColor:"#6b9080f8",color:"white",fontSize:"14px"}}},l={control:(e,s)=>({...e,height:"45px",background:"rgba(255, 255, 255, 0.322)"}),menu:(e,s)=>({...e,zIndex:9999})},c=[{id:1,headname:"Menu ID",variant:"head",align:"left",width:100},{id:2,headname:"MenuName"},{id:3,headname:"Read Rights"},{id:4,headname:"Add Rights"},{id:5,headname:"Edit Rights"},{id:6,headname:"Delete Rights"},{id:7,headname:"Print Rights"},{id:8,headname:"Action"}],n=[{dataBase:1,name:"SHANKAR TRADERS",business:"Wholesale Merchant in Dhall",address:"32, Chitrakara Street, Madurai - 01 <br /> Bill of Supply -Disclaimer Affidavlt Field Extemped",logo:t,gstin:"33AADFS6973R1ZD",phone:"984-313-1353, 984-335-5166",fssai:"12418012000818",bankAccount:"0021 5032 0885 122",ifsc:"TMBL0000002"},{dataBase:2,name:"SMT AGRO PRODUCTS",business:"",address:"H.O: 153, Chitrakara Street, 2nd Floor, Madurai -01 <br /> G.O: 746 Puliyur, Sayanapuram, Svga <br /> Bill of Supply -Disclaimer Affidavlt Field Extemped",logo:t,gstin:"33ACMFS3420Q1ZQ",phone:"0452-4371625",fssai:"12418012000818",bankAccount:"0025 3031 0875 947",ifsc:"TMBL0000002"},{dataBase:3,name:"BHAVANI TRADERS",business:"",address:"H.O: 152-A, Chitrakara Street, Madurai -01 <br /> G.O: 30/1-Rajman Nagar, Chintamani Main Road, Mdu-01 <br /> Tax Invoice",logo:t,gstin:"33AAEFB6728J1ZG",phone:"958-559-7641, 958-559-7614",fssai:"12418012000670",bankAccount:"0021 5005 0800 309",ifsc:"TMBL0000002"}]},25576:(e,s,a)=>{a.r(s),a.d(s,{default:()=>le});var t=a(69060),r=a(5548),l=a(82656),c=a(26773),n=a(4488),d=a(90048),o=a(28655),i=a(14168),h=a(86e3),m=a(57704),p=a(56480),u=a(77536),x=a(1908),y=(a(21680),a(64568)),j=a(39308),_=a(82496);const g=e=>{let{open:s,onClose:a,inputValue:r,isEdit:o,setReload:i}=e;const h=localStorage.getItem("user"),m=JSON.parse(h),[u,g]=(0,t.useState)([]),[T,b]=(0,t.useState)([]),[v,k]=(0,t.useState)({Project_Id:"",Project_Name:"",Project_Desc:"",Project_Head:"",Est_Start_Dt:(0,j.Q7)(),Est_End_Dt:(0,j.Q7)(),Project_Status:"",Entry_By:null===m||void 0===m?void 0:m.UserId,Company_id:null===m||void 0===m?void 0:m.Company_id});(0,t.useEffect)((()=>{(0,x.q)({address:"masters/users/employee/dropDown?Company_id=".concat(null===m||void 0===m?void 0:m.Company_id)}).then((e=>{g(e.success?e.data:[])})).catch((e=>console.error("Fetch Error:",e)))}),[null===m||void 0===m?void 0:m.Company_id]),(0,t.useEffect)((()=>{(0,x.q)({address:"taskManagement/statusList"}).then((e=>{e.success&&b(e.data)})).catch((e=>console.error("Fetch Error:",e)))}),[]),(0,t.useEffect)((()=>{s&&(console.log("inputValue",r),o&&r?(console.log(r),k({...r,Project_Head:r.Proejct_Head||"",Est_Start_Dt:r.Est_Start_Dt?(0,j.Q7)(r.Est_Start_Dt):"",Est_End_Dt:r.Est_End_Dt?(0,j.Q7)(r.Est_End_Dt):""})):o||k({Project_Id:"",Project_Name:"",Project_Desc:"",Project_Head:"",Est_Start_Dt:(0,j.Q7)(),Est_End_Dt:(0,j.Q7)(),Project_Status:"",Entry_By:null===m||void 0===m?void 0:m.UserId,Company_id:null===m||void 0===m?void 0:m.Company_id}))}),[r,s,o]);const S=e=>{k({...v,[e.target.name]:e.target.value})},f=()=>{const e=["Project_Name","Project_Head","Est_Start_Dt","Est_End_Dt","Project_Status"];for(const s of e)if(!v[s])return p.m4.error("".concat(s.replace(/_/g," ")," is required")),!1;return!0},I=[{label:"Project Name",elem:"input",type:"text",required:!0,name:"Project_Name",value:v.Project_Name||""},{label:"Project Head",elem:"select",options:u.map((e=>({value:null===e||void 0===e?void 0:e.UserId,label:null===e||void 0===e?void 0:e.Name}))),required:!0,name:"Project_Head",value:v.Project_Head||""},{label:"Estimated Start Date",elem:"input",type:"date",required:!0,name:"Est_Start_Dt",value:v.Est_Start_Dt||""},{label:"Estimated End Date",elem:"input",type:"date",required:!0,name:"Est_End_Dt",value:v.Est_End_Dt||""},{label:"Project Status",elem:"select",options:T.map((e=>({value:e.Status_Id,label:e.Status}))),required:!0,name:"Project_Status",value:v.Project_Status||""},{label:"Description",elem:"textarea",name:"Project_Desc",value:v.Project_Desc||" "}];return(0,_.jsx)(_.Fragment,{children:(0,_.jsxs)(l.c,{open:s,onClose:a,children:[(0,_.jsx)(c.c,{className:"bg-primary text-white mb-2 px-3 py-2",children:o?"Edit Project":"Create Project"}),(0,_.jsx)(n.c,{children:(0,_.jsxs)("form",{onSubmit:e=>{e.preventDefault(),o?f()&&(0,x.q)({address:"taskManagement/project",method:"PUT",bodyData:v}).then((e=>{e.success?(a(),i((e=>!e)),p.m4.success(e.message)):p.m4.error(e.message)})).catch((e=>console.error("Fetch Error:",e))):(()=>{if(!f())return;const e={...v,Company_id:m.Company_id};(0,x.q)({address:"taskManagement/project",method:"POST",bodyData:e}).then((e=>{e.success?(a(),i((e=>!e)),p.m4.success(e.message)):p.m4.error(e.message)})).catch((e=>{console.error("Fetch Error:",e),p.m4.error("An error occurred while creating the project.")}))})()},children:[(0,_.jsx)("div",{className:"row",children:I.map(((e,s)=>(0,_.jsxs)("div",{className:"col-lg-4 mb-3",children:[(0,_.jsxs)("label",{children:[e.label," ",e.required&&(0,_.jsx)(y.c,{})]}),"textarea"===e.elem?(0,_.jsx)("textarea",{name:e.name,className:"cus-inpt",value:e.value,onChange:S}):"select"===e.elem?(0,_.jsxs)("select",{name:e.name,className:"cus-inpt",value:e.value,onChange:S,children:[(0,_.jsx)("option",{value:"",children:"Select"}),e.options&&e.options.map(((e,s)=>(0,_.jsx)("option",{value:e.value,children:e.label},s)))]}):(0,_.jsx)("input",{type:e.type,name:e.name,className:"cus-inpt",value:e.value,onChange:S})]},s)))}),(0,_.jsxs)(d.c,{children:[(0,_.jsx)("button",{className:"btn btn-light rounded-5 px-3",type:"button",onClick:a,children:"Cancel"}),(0,_.jsx)("button",{className:"btn btn-primary rounded-5 px-3",type:"submit",children:o?"Update":"Submit"})]})]})})]})})};var T=a(89e3),b=a(99904),v=a(33856),k=a(58612),S=a(27454),f=a(700),I=a(29504),N=a(71448),C=a(44380),E=a(12572),D=a(76552);const P=e=>{let{open:s,onClose:a,projectId:r,onReload:o}=e;const i={Name:"",Designation_Name:"",BranchName:""},[h,m]=(0,t.useState)(i),[y,j]=(0,t.useState)(!0),[g,P]=(0,t.useState)(!1),[w,A]=(0,t.useState)([]),[R,B]=(0,t.useState)([]),O=localStorage.getItem("user"),q=JSON.parse(O),{contextObj:F}=(0,t.useContext)(u.a);(0,t.useEffect)((()=>{s&&r&&(M(),L(),W())}),[s,r]);const M=async()=>{j(!0);try{const e=await(0,x.q)({address:"masters/Employeedetails?Project_Id=".concat(r)});e.success&&m(e.data)}catch(e){console.error(e),p.m4.error("Failed to fetch employee details")}finally{j(!1)}},L=async()=>{j(!0);try{const e=await(0,x.q)({address:"masters/Employeedetails/dropDown?Company_id=".concat(q.Company_id)});e.success&&A(e.data)}catch(e){console.error(e),p.m4.error("Failed to fetch employees for dropdown")}finally{j(!1)}},W=async()=>{j(!0);try{const e=await(0,x.q)({address:"masters/Employeedetails?Project_Id=".concat(r)});e.success&&B(e.data)}catch(e){console.error(e),p.m4.error("Failed to fetch assigned employees")}finally{j(!1)}},G=()=>{a(),m(i)};return(0,_.jsxs)(_.Fragment,{children:[(0,_.jsxs)(l.c,{open:s,maxWidth:"sm",fullWidth:!0,children:[(0,_.jsxs)(E.c,{display:"flex",justifyContent:"space-between",alignItems:"center",marginTop:2,marginInlineStart:2,children:[(0,_.jsx)("span",{children:"Employee Details"}),(0,_.jsx)(d.c,{children:(0,_.jsx)(T.c,{variant:"contained",color:"primary",onClick:()=>{P(!0)},sx:{mr:1},children:"Add"})})]}),(0,_.jsx)(n.c,{children:y?(0,_.jsx)("p",{children:"Loading..."}):(0,_.jsx)(b.c,{children:(0,_.jsxs)(v.c,{children:[(0,_.jsx)(k.c,{children:(0,_.jsxs)(S.c,{children:[(0,_.jsx)(f.c,{children:"Employee Name"}),(0,_.jsx)(f.c,{children:"Position"}),(0,_.jsx)(f.c,{children:"Department"})]})}),(0,_.jsx)(I.c,{children:Array.isArray(h)&&h.length>0?h.map((e=>(0,_.jsxs)(S.c,{children:[(0,_.jsx)(f.c,{children:e.Name||"N/A"}),(0,_.jsx)(f.c,{children:e.Designation_Name||"-"}),(0,_.jsx)(f.c,{children:e.BranchName||"-"})]},e.EmployeeId||e.UserId))):(0,_.jsx)(S.c,{children:(0,_.jsx)(f.c,{colSpan:3,children:"No data available"})})})]})})}),(0,_.jsx)(d.c,{sx:{marginTop:"auto ",position:"sticky",bottom:0},children:(0,_.jsx)(T.c,{variant:"contained",color:"primary",onClick:G,children:"Close"})})]}),(0,_.jsxs)(l.c,{open:g,maxWidth:"sm",fullWidth:!0,children:[(0,_.jsx)(c.c,{children:"Add Employee"}),(0,_.jsx)(n.c,{children:(0,_.jsx)(N.c,{multiple:!0,options:w,getOptionLabel:e=>e.Name,isOptionEqualToValue:(e,s)=>e.UserId===s.UserId,onChange:(e,s)=>{const a=s.filter(((e,s,a)=>s===a.findIndex((s=>s.UserId===e.UserId))));B(a)},PopperComponent:e=>(0,_.jsx)(D.c,{...e,placement:"top"}),value:R,onClose:onclose,renderInput:e=>(0,_.jsx)(C.c,{...e,placeholder:"Employees"})})}),(0,_.jsxs)(d.c,{children:[(0,_.jsx)(T.c,{onClick:()=>{P(!1),G(),m(i)},children:"Cancel"}),(0,_.jsx)(T.c,{onClick:async()=>{if(1===Number(null===F||void 0===F?void 0:F.Add_Rights))try{(await(0,x.q)({address:"masters/Employeedetails/employeeAdd",method:"POST",bodyData:{Project_Id:r,UserIds:R.map((e=>e.UserId))}})).success?(p.m4.success("Employees added successfully"),P(!1),await M(),await W(),o()):p.m4.error("Failed to add employees")}catch(e){console.error(e),p.m4.error("Error adding employees")}},variant:"contained",color:"primary",children:"Add"})]})]})]})};var w=a(32635),A=a(15786),R=a(56880),B=a(6392),O=a(21280),q=a(70564),F=a(27532),M=a(98204),L=a(35880),W=(a(67472),a(68424)),G=a(39504),U=a(52924);const H=(0,_.jsx)(W.c,{fontSize:"small"}),z=(0,_.jsx)(G.c,{fontSize:"small"}),J=e=>{let{row:s,children:a,openAction:r,reload:o,onCloseFun:i,loadingOn:h,loadingOff:m,onTaskAdded:u}=e;const g=localStorage.getItem("user"),T=JSON.parse(g),b={Task_Id:"",Task_Name:"",Task_Desc:"",Task_Group_Id:"",Entry_By:null===T||void 0===T?void 0:T.UserId,Company_id:null===T||void 0===T?void 0:T.Company_id,Entry_Date:"",Update_By:"",Update_Date:"",Task_Parameters:[]},[v,k]=(0,t.useState)(!1),[S,f]=(0,t.useState)(!1),[I,E]=(0,t.useState)([]),[D,P]=(0,t.useState)([]),[w,A]=(0,t.useState)([]),[R,B]=(0,t.useState)(b),[O,q]=(0,t.useState)(!1),[F,M]=(0,t.useState)(b);(0,t.useEffect)((()=>{(async()=>{try{const e=await(0,x.q)({address:"taskManagement/tasks/dropdown"});e.success&&E(e.data);const s=await(0,x.q)({address:"masters/taskType/dropDown"});s.success&&P(s.data);const a=await(0,x.q)({address:"taskManagement/parameters"});a.success&&A(a.data)}catch(e){console.error(e)}})()}),[]),(0,t.useEffect)((()=>{k(r)}),[r]),(0,t.useEffect)((()=>{(0,j.CY)(s)?(B((e=>({...e,...s,Task_Group_Id:s.Task_Group_Id||""}))),f(!0)):(B(b),f(!1))}),[s]);const L=()=>{k(!1),i&&i()},W=()=>{q(!1),M(b)};return(0,_.jsxs)(_.Fragment,{children:[(0,_.jsx)("span",{onClick:()=>k(!0),style:{cursor:"pointer"},children:a}),(0,_.jsxs)(l.c,{open:v,children:[(0,_.jsx)(c.c,{className:"bg-primary text-white mb-2 px-3 py-2",children:S?"Edit Task":"Add Task"}),(0,_.jsxs)("form",{onSubmit:e=>{e.preventDefault(),(async()=>{const e=R.Task_Parameters.map((e=>({...e,Param_Id:e.Paramet_Id})))||[],s={...R,Task_Parameters:e};h&&h();try{const e=await(0,x.q)({address:"taskManagement/tasks",method:S?"PUT":"POST",bodyData:s});e.success?(p.m4.success(e.message),L(),o&&o(),u&&u()):p.m4.error(e.message)}catch(a){console.error(a),p.m4.error("An error occurred while processing your request.")}finally{m&&m()}})()},children:[(0,_.jsx)(n.c,{children:(0,_.jsxs)("div",{className:"row",children:[(0,_.jsxs)("div",{className:"col-md-4 p-2",children:[(0,_.jsxs)("label",{children:["Task Name ",(0,_.jsx)(y.c,{})]}),(0,_.jsx)("input",{maxLength:150,onChange:e=>B({...R,Task_Name:e.target.value}),required:!0,value:R.Task_Name,placeholder:"ex: File Checking",className:"cus-inpt"})]}),(0,_.jsxs)("div",{className:"col-md-4 p-2",children:[(0,_.jsxs)("label",{children:["Task Group ",(0,_.jsx)(y.c,{})]}),(0,_.jsxs)("select",{value:R.Task_Group_Id,className:"cus-inpt",required:!0,onChange:e=>B({...R,Task_Group_Id:e.target.value}),children:[(0,_.jsx)("option",{value:"",disabled:!0,children:"- select -"}),D.map(((e,s)=>(0,_.jsx)("option",{value:e.Task_Type_Id,children:e.Task_Type},s)))]})]}),(0,_.jsxs)("div",{className:"col-md-4 p-2",children:[(0,_.jsx)("label",{children:"Base Task"}),(0,_.jsxs)("select",{value:R.Under_Task_Id,className:"cus-inpt",onChange:e=>B({...R,Under_Task_Id:e.target.value}),children:[(0,_.jsx)("option",{value:0,children:"Primary"}),I.map(((e,s)=>(0,_.jsx)("option",{value:e.Task_Id,children:e.Task_Name},s)))]})]}),(0,_.jsxs)("div",{className:"col-12",children:[(0,_.jsxs)("label",{children:["Task Description ",(0,_.jsx)(y.c,{})]}),(0,_.jsx)("textarea",{className:"cus-inpt",value:R.Task_Desc,rows:"3",onChange:e=>B({...R,Task_Desc:e.target.value})})]}),(0,_.jsx)("div",{className:"col-md-12 p-2",children:(0,_.jsx)(N.c,{multiple:!0,id:"checkboxes-tags-demo",options:w,disableCloseOnSelect:!0,getOptionLabel:e=>"".concat(e.Paramet_Name," - ").concat(e.Paramet_Data_Type),value:R.Task_Parameters||[],onChange:(e,s)=>B({...R,Task_Parameters:s}),renderOption:(e,s,a)=>{let{selected:t}=a;return(0,_.jsxs)("li",{...e,children:[(0,_.jsx)(U.c,{icon:H,checkedIcon:z,style:{marginRight:8},checked:t}),"".concat(s.Paramet_Name," - ").concat(s.Paramet_Data_Type)]})},className:"pt-2",isOptionEqualToValue:(e,s)=>Number(e.Paramet_Id)===Number(s.Paramet_Id),renderInput:e=>(0,_.jsx)(C.c,{...e,label:"Task Parameters",placeholder:"Choose Task Parameters"})})}),R.Task_Parameters.map(((e,s)=>(0,_.jsxs)("div",{className:"col-md-4 p-2",children:[(0,_.jsx)("label",{className:"mb-2",children:e.Paramet_Name}),(0,_.jsx)("input",{type:e.Paramet_Data_Type||"text",className:"cus-inpt",onChange:e=>{const a=[...R.Task_Parameters];a[s]={...a[s],Default_Value:e.target.value},B({...R,Task_Parameters:a})},value:e.Default_Value,placeholder:"Default Value"})]},s)))]})}),(0,_.jsxs)(d.c,{children:[(0,_.jsx)("button",{className:"btn btn-light rounded-5 px-3",type:"button",onClick:L,children:"Cancel"}),(0,_.jsx)("button",{className:"btn btn-primary rounded-5 px-3",type:"submit",children:"Submit"})]})]})]}),(0,_.jsxs)(l.c,{open:O,onClose:W,children:[(0,_.jsx)(c.c,{className:"bg-primary text-white mb-2 px-3 py-2",children:"Edit Task"}),(0,_.jsxs)("form",{onSubmit:e=>{e.preventDefault(),(async()=>{const e=F.Task_Parameters.map((e=>({...e,Param_Id:e.Paramet_Id})))||[],s={...F,Task_Parameters:e};h&&h();try{const e=await(0,x.q)({address:"taskManagement/tasks",method:"PUT",bodyData:s});e.success?(p.m4.success(e.message),W(),u&&u()):p.m4.error(e.message)}catch(a){console.error(a),p.m4.error("An error occurred while processing your request.")}finally{m&&m()}})()},children:[(0,_.jsxs)(n.c,{children:[(0,_.jsx)(C.c,{label:"Task Name",value:F.Task_Name,onChange:e=>M({...F,Task_Name:e.target.value}),fullWidth:!0}),(0,_.jsxs)(C.c,{label:"Task Group",select:!0,value:F.Task_Group_Id,onChange:e=>M({...F,Task_Group_Id:e.target.value}),fullWidth:!0,children:[(0,_.jsx)("option",{value:"",disabled:!0,children:"- select -"}),D.map(((e,s)=>(0,_.jsx)("option",{value:e.Task_Type_Id,children:e.Task_Type},s)))]})]}),(0,_.jsxs)(d.c,{children:[(0,_.jsx)("button",{className:"btn btn-light rounded-5 px-3",type:"button",onClick:W,children:"Cancel"}),(0,_.jsx)("button",{className:"btn btn-primary rounded-5 px-3",type:"submit",children:"Save"})]})]})]})]})};var V=a(55888),Q=a(30612),Y=a(62344);const K=e=>{let{open:s,onClose:a,projectId:r,taskId:o,reload:i,editData:h}=e;const m=localStorage.getItem("user"),u=JSON.parse(m),[y,j]=(0,t.useState)([]),[g,b]=(0,t.useState)(!1),[v,k]=(0,t.useState)([]),[S,f]=(0,t.useState)([]),I={AN_No:"",Project_Id:r,Sch_Id:o,Assigned_Emp_Id:null===u||void 0===u?void 0:u.UserId,Emp_Id:"",Task_Assign_dt:(new Date).toISOString().split("T")[0],Sch_Period:"",Sch_Time:"",EN_Time:"",Est_Start_Dt:"",Est_End_Dt:"",Ord_By:1,Timer_Based:!1,Sch_Type:"",Invovled_Stat:!0,EmpGet:"- Select -",Is_Repitative:!1,RepeatDays:{Mon:!1,Tue:!1,Wed:!1,Thu:!1,Fri:!1,Sat:!1,Sun:!1}},[N,C]=(0,t.useState)(I);(0,t.useEffect)((()=>{s&&(async()=>{b(!0);try{const e=await(0,x.q)({address:"masters/Employeedetails/getusersproject?Project_Id=".concat(r)}),s=await(0,x.q)({address:"taskManagement/project/schedule/newscheduleType"});e.success&&j(e.data||[]),s.success&&k(s.data||[])}catch(e){p.m4.error("Failed to fetch data.")}finally{b(!1)}})()}),[r,s,i]),(0,t.useEffect)((()=>{s&&(async()=>{b(!0);try{if(h){var e,s;const a=await(0,x.q)({address:"masters/employeedetails/selectedTaskDetails?projectId=".concat(r,"&Sch_Id=").concat(o.Sch_Id,"&Task_Id=").concat(o.Task_Id)}),t=null===(e=a.data[0])||void 0===e?void 0:e.Sch_Type_Id,l=null===(s=a.data[0])||void 0===s?void 0:s.Sch_Name;f(t&&l?{value:t,label:l}:{value:"",label:""})}else{var a,t;const e=await(0,x.q)({address:"masters/employeedetails/selectedTaskDetails?projectId=".concat(r,"&Sch_Id=").concat(o.TaskSchId,"&Task_Id=").concat(o.Task_Id)}),s=null===(a=e.data[0])||void 0===a?void 0:a.Sch_Type_Id,l=null===(t=e.data[0])||void 0===t?void 0:t.Sch_Name;f(s&&l?{value:s,label:l}:{value:"",label:""})}}catch(l){p.m4.error("Failed to fetch data.")}finally{b(!1)}})()}),[s,h,i]),(0,t.useEffect)((()=>{h&&C((e=>({...e,AN_No:h.AN_No,Emp_Id:h.Emp_Id,Sch_Time:h.Sch_Time,EN_Time:h.EN_Time,Est_Start_Dt:h.Est_Start_Dt.split("T")[0],Est_End_Dt:h.Est_End_Dt.split("T")[0],Ord_By:h.Ord_By,Timer_Based:h.Timer_Based,Invovled_Stat:h.Invovled_Stat,Sch_Type_Id:h.Sch_Type,Sch_Type:h.Sch_Type_Name,EmpGet:h.EmployeeName,Is_Repitative:h.Is_Repitative,RepeatDays:{Mon:!!h.IS_Rep_Monday,Tue:!!h.IS_Rep_Tuesday,Wed:!!h.IS_Rep_Wednesday,Thu:!!h.IS_Rep_Thursday,Fri:!!h.Is_Rep_Friday,Sat:!!h.Is_Rep_Saturday,Sun:!!h.Is_Rep_Sunday}})))}),[h]);return(0,_.jsx)(_.Fragment,{children:(0,_.jsxs)(l.c,{open:s,maxWidth:"sm",children:[(0,_.jsx)(c.c,{children:h?"Edit Task":"Employee Assign"}),(0,_.jsxs)("form",{onSubmit:async e=>{e.preventDefault();const s=(()=>{const[e,s]=N.Sch_Time.split(":").map(Number),[a,t]=N.EN_Time.split(":").map(Number),r=new Date(0,0,0,e,s),l=new Date(0,0,0,a,t);if(l>r){let e=Math.abs(l-r);const s=Math.floor(e/36e5),a=Math.floor(e/6e4);return"".concat(String(s).padStart(2,"0"),":").concat(String(a).padStart(2,"0"))}return""})();if(N.Est_End_Dt<N.Est_Start_Dt)p.m4.error("End date must be greater than start date.");else try{const e=h?"masters/employeedetails/updateTask":"masters/employeedetails/assignTask",t={IS_Rep_Monday:N.RepeatDays.Mon?1:null,IS_Rep_Tuesday:N.RepeatDays.Tue?1:null,IS_Rep_Wednesday:N.RepeatDays.Wed?1:null,IS_Rep_Thursday:N.RepeatDays.Thu?1:null,Is_Rep_Friday:N.RepeatDays.Fri?1:null,Is_Rep_Saturday:N.RepeatDays.Sat?1:null,Is_Rep_Sunday:N.RepeatDays.Sun?1:null};(await(0,x.q)({address:e,method:h?"PUT":"POST",bodyData:{...N,Project_Id:r,Sch_Id:h?o.Sch_Id:o.TaskSchId,Task_Levl_Id:o.Task_Levl_Id,Task_Id:Number(o.Task_Id),Assigned_Emp_Id:N.Assigned_Emp_Id,Emp_Id:N.Emp_Id,Sch_Period:s,Sch_Time:N.Sch_Time,EN_Time:N.EN_Time,Est_Start_Dt:N.Est_Start_Dt,Est_End_Dt:N.Est_End_Dt,Ord_By:N.Ord_By,Sch_Type:S.value,Timer_Based:N.Timer_Based?1:0,Invovled_Stat:N.Invovled_Stat?1:0,Is_Repitative:N.Is_Repitative?1:0,RepeatDays:N.Is_Repitative?N.RepeatDays:"",...t}})).success?(p.m4.success("Task ".concat(h?"updated":"assigned"," successfully!")),C({}),a(),i()):p.m4.error("Please fill the values correctly")}catch(t){p.m4.error("Error during task assignment/update: "+t.message)}},children:[(0,_.jsx)(n.c,{className:"table-responsive",children:(0,_.jsx)("table",{className:"table",style:{tableLayout:"fixed"},children:(0,_.jsxs)("tbody",{children:[(0,_.jsxs)("tr",{children:[(0,_.jsx)("td",{className:"border-bottom-0 fa-15",style:{verticalAlign:"middle",paddingRight:"1em"},children:"Employee"}),(0,_.jsx)("td",{className:"border-bottom-0 fa-15",style:{paddingLeft:"1em"},children:(0,_.jsx)(Q.cp,{value:{value:N.Emp_Id,label:N.EmpGet},onChange:e=>C({...N,Emp_Id:e.value,EmpGet:e.label}),options:[{value:"",label:"- Select -"},...y.map((e=>({value:e.UserId,label:e.Name})))],styles:Y.cF,required:!0,isSearchable:!0,placeholder:"Select User"})})]}),(0,_.jsxs)("tr",{children:[(0,_.jsx)("td",{className:"border-bottom-0 fa-15",style:{verticalAlign:"middle",paddingRight:"1em"},children:"Sch_Type"}),(0,_.jsx)("td",{className:"border-bottom-0 fa-15",style:{paddingLeft:"1em"},children:(0,_.jsx)(Q.cp,{value:S?{value:S.value,label:"".concat(S.label)}:null,styles:{padding:"0.5em"},isDisabled:!0,placeholder:"Select Sch_Type"})})]}),(0,_.jsxs)("tr",{children:[(0,_.jsx)("td",{className:"border-bottom-0 fa-15",style:{verticalAlign:"middle",paddingRight:"1em"},children:"Start Time"}),(0,_.jsx)("td",{className:"border-bottom-0 fa-15",style:{paddingLeft:"1em"},children:(0,_.jsx)("input",{type:"time",className:"cus-inpt",value:N.Sch_Time,required:!0,onChange:e=>C({...N,Sch_Time:e.target.value}),style:{padding:"0.5em"}})})]}),(0,_.jsxs)("tr",{children:[(0,_.jsx)("td",{className:"border-bottom-0 fa-15",style:{verticalAlign:"middle",paddingRight:"1em"},children:"End Time"}),(0,_.jsx)("td",{className:"border-bottom-0 fa-15",style:{paddingLeft:"1em"},children:(0,_.jsx)("input",{type:"time",className:"cus-inpt",value:N.EN_Time,required:!0,min:N.Sch_Time,onChange:e=>C({...N,EN_Time:e.target.value}),style:{padding:"0.5em"}})})]}),(0,_.jsxs)("tr",{children:[(0,_.jsx)("td",{className:"border-bottom-0 fa-15",style:{verticalAlign:"middle",paddingRight:"1em"},children:"Est. Start Date"}),(0,_.jsx)("td",{className:"border-bottom-0 fa-15",style:{paddingLeft:"1em"},children:(0,_.jsx)("input",{type:"date",className:"cus-inpt",value:N.Est_Start_Dt,required:!0,onChange:e=>C({...N,Est_Start_Dt:e.target.value}),style:{padding:"0.5em"}})})]}),(0,_.jsxs)("tr",{children:[(0,_.jsx)("td",{className:"border-bottom-0 fa-15",style:{verticalAlign:"middle",paddingRight:"1em"},children:"Est. End Date"}),(0,_.jsx)("td",{className:"border-bottom-0 fa-15",style:{paddingLeft:"1em"},children:(0,_.jsx)("input",{type:"date",className:"cus-inpt",value:N.Est_End_Dt,required:!0,min:N.Est_Start_Dt,onChange:e=>C({...N,Est_End_Dt:e.target.value}),style:{padding:"0.5em"}})})]}),(0,_.jsx)("tr",{children:(0,_.jsxs)("td",{className:"border-bottom-0 fa-15 text-start",style:{paddingRight:"1em"},children:[(0,_.jsxs)("div",{style:{display:"inline-flex",marginRight:"1em"},children:[(0,_.jsx)("input",{className:"form-check-input shadow-none",type:"checkbox",id:"timerbased",checked:Boolean(Number(null===N||void 0===N?void 0:N.Timer_Based)),onChange:e=>C({...N,Timer_Based:e.target.checked}),style:{marginRight:"0.5em"}}),(0,_.jsx)("label",{className:"form-check-label p-1 ps-2",htmlFor:"timerbased",children:"Timer Based Task?"})]}),h&&(0,_.jsxs)("div",{style:{display:"inline-flex",marginRight:"1em"},children:[(0,_.jsx)("input",{className:"form-check-input shadow-none",type:"checkbox",checked:Boolean(Number(null===N||void 0===N?void 0:N.Invovled_Stat)),onChange:()=>C({...N,Invovled_Stat:!N.Invovled_Stat}),style:{marginRight:"0.5em"}}),(0,_.jsx)("label",{className:"form-check-label p-1 ps-2",children:"Involved Status"})]})]})}),(0,_.jsx)("tr",{children:(0,_.jsx)("td",{className:"border-bottom-0 fa-15",style:{paddingRight:"1em"},children:(0,_.jsxs)("div",{style:{display:"flex",alignItems:"center",flexWrap:"wrap"},children:[(0,_.jsxs)("div",{style:{display:"flex",alignItems:"center",marginRight:"1em"},children:[(0,_.jsx)("input",{type:"checkbox",checked:1===N.Is_Repitative,onChange:e=>{C((s=>({...s,Is_Repitative:e.target.checked?1:0})))},style:{marginRight:"1em"}}),(0,_.jsx)("label",{style:{marginBottom:"0"},children:"Is Repetitive?"})]}),1===N.Is_Repitative&&(0,_.jsx)("div",{style:{display:"inline-flex",gap:"0.5em"},children:["Mon","Tue","Wed","Thu","Fri","Sat","Sun"].map((e=>(0,_.jsxs)("label",{style:{display:"flex",alignItems:"center",marginRight:"1em",width:"30px"},children:[(0,_.jsx)("input",{type:"checkbox",checked:N.RepeatDays[e],onChange:()=>C({...N,RepeatDays:{...N.RepeatDays,[e]:!N.RepeatDays[e]}}),style:{marginRight:"0.5em"}}),e]},e)))})]})})})]})})}),(0,_.jsxs)(d.c,{children:[(0,_.jsx)(T.c,{onClick:()=>{a(),C(I)},variant:"outlined",children:"Close"}),(0,_.jsx)(T.c,{type:"submit",variant:"contained",children:"Save Changes"})]})]})]})})};var Z=a(63468),$=a(63172),X=a(86848);const ee=function(e){let{open:s,onClose:a,taskDetails:d,closeDialogTask:o}=e;const[i,m]=(0,t.useState)(null),[p,x]=(0,t.useState)(!1),[y,j]=(0,t.useState)(!0),{contextObj:g}=(0,t.useContext)(u.a);(0,t.useEffect)((()=>{s&&(m(null),j(!0),setTimeout((()=>{j(!1)}),500))}),[s]);const N=e=>{if(!e)return"N/A";const s=new Date(e);if(isNaN(s.getTime()))return"Invalid Date";const a=String(s.getDate()).padStart(2,"0"),t=String(s.getMonth()+1).padStart(2,"0"),r=s.getFullYear();return"".concat(a,"-").concat(t,"-").concat(r)};return(0,_.jsxs)(_.Fragment,{children:[(0,_.jsxs)(l.c,{open:s,maxWidth:"lg",children:[(0,_.jsx)(c.c,{children:(0,_.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,_.jsx)("span",{children:"Details"}),(0,_.jsx)(T.c,{variant:"contained",color:"primary",onClick:a,children:"Close"})]})}),(0,_.jsx)(n.c,{children:y?(0,_.jsx)("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",height:"300px",width:"500px"},children:(0,_.jsx)(Z.c,{})}):(0,_.jsx)(b.c,{children:(0,_.jsxs)(v.c,{children:[(0,_.jsx)(k.c,{children:(0,_.jsxs)(S.c,{children:[(0,_.jsx)(f.c,{className:"fa-14 text-center",children:"Employee"}),(0,_.jsx)(f.c,{className:"fa-14 text-center",children:"Assigned By"}),(0,_.jsx)(f.c,{className:"fa-14 text-center",children:"Start-End Date"}),(0,_.jsx)(f.c,{className:"fa-14 text-center",children:"Start-End Time"}),(0,_.jsx)(f.c,{className:"fa-14 text-center",children:"Total Hours"}),(0,_.jsx)(f.c,{className:"fa-14 text-center",children:"Timer Based"}),(0,_.jsx)(f.c,{className:"fa-14 text-center",children:"Involved Status"}),(0,_.jsx)(f.c,{className:"fa-14 text-center",children:"Order By"}),(0,_.jsx)(f.c,{className:"fa-14 text-center",children:"Action"})]})}),(0,_.jsx)(I.c,{children:0===d.length?(0,_.jsx)(S.c,{children:(0,_.jsx)(f.c,{colSpan:9,className:"fa-14 text-center",style:{textAlign:"center"},children:"No data found"})}):d.map(((e,s)=>(0,_.jsxs)(S.c,{children:[(0,_.jsx)(f.c,{className:"fa-13 text-center",children:e.EmployeeName||"N/A"}),(0,_.jsx)(f.c,{className:"fa-13 text-center",children:e.AssignedUser||"N/A"}),(0,_.jsx)(f.c,{className:"fa-14 text-center",children:(0,_.jsxs)("span",{className:"badge rounded-4 px-3 bg-light text-primary",children:[(0,_.jsx)($.c,{className:"fa-18 me-2"}),N(e.Est_Start_Dt)," - ",N(e.Est_End_Dt)]})}),(0,_.jsx)(f.c,{className:"fa-14 text-center",children:(0,_.jsxs)("span",{className:"badge rounded-4 px-3 bg-light text-primary",children:[(0,_.jsx)(X.c,{className:"fa-18 me-2"}),e.Sch_Time||"N/A"," - ",e.EN_Time||"N/A"]})}),(0,_.jsx)(f.c,{className:"fa-13 text-center",children:e.Sch_Period||"N/A"}),(0,_.jsx)(f.c,{className:"fa-14 text-center",children:(0,_.jsx)("span",{className:"badge rounded-4 px-3 fw-bold text-white ".concat(Number(e.Timer_Based)?"bg-success":"bg-warning"),children:Number(e.Timer_Based)?"Yes":"No"})}),(0,_.jsx)(f.c,{className:"fa-14 text-center",children:(0,_.jsx)("span",{className:"badge rounded-4 px-3 fw-bold text-white ".concat(Number(e.Invovled_Stat)?"bg-success":"bg-danger"),children:Number(e.Invovled_Stat)?"IN":"OUT"})}),(0,_.jsx)(f.c,{className:"fa-13 text-center",children:e.Ord_By||"N/A"}),1===Number(null===g||void 0===g?void 0:g.Edit_Rights)&&(0,_.jsx)(f.c,{className:"fa-13 text-center",children:(0,_.jsxs)(r.c,{size:"small",onClick:()=>(m(e),void x(!0)),children:[(0,_.jsx)(h.c,{className:"fa-18"}),"Edit"]})})]},s)))})]})})})]}),p&&(0,_.jsx)(K,{open:p,projectId:null===i||void 0===i?void 0:i.Project_Id,taskId:i,editData:i,onClose:()=>{x(!1),a()}})]})};var se=a(18256),ae=a(29720),te=a(61584);const re=function(e){let{dialogOpen:s,setDialogOpen:a,projectid:o,reload:i,onReload:m,selectedProject:y}=e;const[j,g]=(0,t.useState)(!1),[I,N]=(0,t.useState)(!1),[C,D]=(0,t.useState)(!1),[P,w]=(0,t.useState)(null),[W,G]=(0,t.useState)([]),[U,H]=(0,t.useState)([]),[z,Q]=(0,t.useState)(!1),[Y,Z]=(0,t.useState)({}),[$,X]=(0,t.useState)([]),[re,le]=(0,t.useState)(!1),ce=JSON.parse(localStorage.getItem("user")),ne=null===ce||void 0===ce?void 0:ce.UserId,de=null===ce||void 0===ce?void 0:ce.Company_id,[oe,ie]=(0,t.useState)(!1),[he,me]=(0,t.useState)(null),[pe,ue]=(0,t.useState)(null),[xe,ye]=(0,t.useState)(null),{contextObj:je}=(0,t.useContext)(u.a),[_e,ge]=(0,t.useState)(!1),[Te,be]=(0,t.useState)(!1),[ve,ke]=(0,t.useState)({schTypeId:null,taskId:null}),[Se,fe]=(0,t.useState)("overall"),[Ie,Ne]=(0,t.useState)([]),Ce=(e,s)=>{fe(s)},Ee=e=>{me((s=>s===e?null:e))},De=e=>{ye((s=>s===e?null:e))},Pe=(0,t.useCallback)((async()=>{try{const e=await(0,x.q)({address:"taskManagement/tasks/dropdown?Company_id=".concat(de)});e.success?G(e.data):p.m4.error(e.message)}catch(e){console.error(e)}}),[de]),we=(0,t.useCallback)((async()=>{try{const e=await(0,x.q)({address:"taskManagement/project/schedule/ListingDetails?Project_Id=".concat(o)});e.success?X(e.data):console.error("Failed to fetch task details:",e.message)}catch(e){console.error("Error fetching task details:",e)}}),[o]);(0,t.useEffect)((()=>{Pe(),we(),(async()=>{(0,x.q)({address:"taskManagement/project/schedule/newscheduleType"}).then((e=>{e.success?Ne(e.data):p.m4.error(e.message)}))})()}),[i,o,m,Pe,we]);const Ae=W.map((e=>({value:e.Task_Id,label:e.Task_Name}))),Re=async e=>{if(Q(!0),e.Task_Id&&o)try{const s=await(0,x.q)({address:"masters/employeedetails/assignedTaskDetails?Task_Id=".concat(e.Task_Id,"&ProjectId=").concat(o,"&LevelId=").concat(e.Task_Levl_Id)});s.success?H(s.data):console.error(s.message)}catch(s){console.error("Error fetching task details:",s)}else p.m4.error("Task ID and Project ID are required")},Be=e=>{const s=Ie.find((s=>s.Sch_Type_Id===parseInt(e.target.value)));s&&Z({...Y,Sch_Type_Id:s.Sch_Type_Id,Sch_Type:s.Sch_Type})};return(0,_.jsxs)(_.Fragment,{children:[Te&&(0,_.jsxs)(l.c,{open:Te,fullWidth:!0,maxWidth:"sm",PaperProps:{style:{borderRadius:"8px"}},onClose:()=>be(!1),children:[(0,_.jsx)(c.c,{children:_e?"Edit Task":"Assign Task"}),(0,_.jsx)(n.c,{children:(0,_.jsx)("div",{style:{padding:"1px",display:"flex"},children:(0,_.jsxs)("div",{style:{flex:1,display:"flex",alignItems:"center"},children:[(0,_.jsx)("label",{style:{marginRight:"8px"},children:"Sch_Type"}),(0,_.jsxs)("select",{value:Y.Sch_Type_Id||"",onChange:Be,className:"cus-inpt",required:!0,style:{marginLeft:"10px"},children:[(0,_.jsx)("option",{value:"",disabled:!0,children:"- Sch_Type -"}),Ie.map(((e,s)=>(0,_.jsx)("option",{value:e.Sch_Type_Id,children:e.Sch_Type},s)))]})]})})}),(0,_.jsxs)(d.c,{children:[(0,_.jsx)(T.c,{onClick:()=>be(!1),children:"Cancel"}),(0,_.jsx)(T.c,{variant:"contained",color:"primary",onClick:()=>(async e=>{const s={Sch_Project_Id:e.Sch_Project_Id,Sch_Id:e.TaskSchId,schtypeid:Y.Sch_Type_Id,Task_Id:e.Task_Id};try{const e=await(0,x.q)({address:"taskManagement/project/schedule/updateScheduleTaskUpdate",method:"PUT",bodyData:s});e.success?(p.m4.success(e.message),be(!1),ge(!1),m()):(e.status,p.m4.warn(e.message||"Task already exists for this project."))}catch(a){p.m4.error(a)}})(Y),children:"Save"})]})]}),(0,_.jsxs)(l.c,{open:s,fullWidth:!0,maxWidth:"lg",PaperProps:{style:{height:"75vh"}},children:[(0,_.jsx)(c.c,{children:(0,_.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,_.jsx)("span",{children:null===y||void 0===y?void 0:y.Project_Name}),(0,_.jsx)(T.c,{variant:"contained",color:"primary",onClick:()=>N(!0),children:"Assign Task"})]})}),(0,_.jsx)(E.c,{sx:{width:"100%",typography:"body1"},children:$.map(((e,s)=>{const a=JSON.parse(e.SchTypes),t=JSON.parse(e.OverallSchTypes);return(0,_.jsxs)(se.cp,{value:Se,children:[(0,_.jsx)(E.c,{sx:{borderBottom:1,borderColor:"divider"},children:(0,_.jsxs)(ae.c,{onChange:Ce,"aria-label":"Schedule Types",children:[(0,_.jsx)(A.c,{label:"Overall",value:"overall",id:"tab-overall","aria-controls":"tabpanel-overall"}),Array.isArray(a)&&a.length>0?a.map(((e,s)=>(0,_.jsx)(A.c,{label:e.SchType||"No SchType",value:(e.SchTypeId||s).toString(),id:"tab-".concat(e.SchTypeId||s),"aria-controls":"tabpanel-".concat(e.SchTypeId||s)},"".concat(e.SchTypeId||"index","-").concat(s)))):(0,_.jsxs)(R.c,{variant:"body2",color:"textSecondary",sx:{padding:2},children:["No Details Available for ",a]})]})}),"overall"===Se&&(0,_.jsx)(te.c,{value:"overall",id:"tabpanel-overall","aria-labelledby":"tab-overall",children:(0,_.jsx)(E.c,{sx:{marginBottom:2,padding:2,borderRadius:"8px"},children:Array.isArray(t)&&t.length>0?t.map(((e,s)=>{var a,t;return(0,_.jsxs)(E.c,{sx:{marginBottom:3},children:[(0,_.jsxs)(R.c,{variant:"body2",display:"flex",justifyContent:"space-between",alignItems:"center",children:[(0,_.jsxs)(E.c,{children:["Total Tasks:",(0,_.jsx)("strong",{children:(null===e||void 0===e||null===(a=e.TaskCounts[0])||void 0===a?void 0:a.TotalTasks)||0})]}),(0,_.jsxs)(E.c,{textAlign:"right",children:["Completed Tasks:",(0,_.jsx)("strong",{children:(null===e||void 0===e||null===(t=e.TaskCounts[0])||void 0===t?void 0:t.CompletedTasks)||0})]})]}),Array.isArray(e.SchTypes)&&e.SchTypes.length>0?e.SchTypes.map((e=>(0,_.jsxs)(B.c,{expanded:he===e.SchTypeId,onChange:()=>Ee(e.SchTypeId),sx:{backgroundColor:"#f0f4ff",boxShadow:"black"},children:[(0,_.jsxs)(O.c,{expandIcon:(0,_.jsx)(V.c,{}),children:[(0,_.jsx)(R.c,{fontWeight:"bold",children:e.SchType}),(0,_.jsx)(E.c,{sx:{textAlign:"right",flexGrow:1},children:(0,_.jsxs)(R.c,{variant:"h6",children:[(0,_.jsx)(R.c,{fontWeight:"bold",children:"Completed Task / Total Task"}),e.TaskCountsInSchType.map(((e,s)=>(0,_.jsxs)(R.c,{sx:{textAlign:"right",flexGrow:1},children:[e.CompletedTasks," / ",e.TotalTasks]},s)))]})})]}),(0,_.jsx)(q.c,{children:Array.isArray(e.TaskTypeGroups)&&e.TaskTypeGroups.length>0?e.TaskTypeGroups.map((s=>(0,_.jsxs)(B.c,{expanded:xe===s.Task_Type_Id,onChange:()=>De(s.Task_Type_Id),sx:{backgroundColor:"#e8f4f8",marginBottom:2},children:[(0,_.jsx)(O.c,{expandIcon:(0,_.jsx)(V.c,{}),children:(0,_.jsx)(R.c,{fontWeight:"bold",children:s.Task_Type||"Default Task Type"})}),(0,_.jsx)(q.c,{children:Array.isArray(s.Tasks)&&s.Tasks.length>0?s.Tasks.map((s=>(0,_.jsxs)(B.c,{expanded:pe===s.Task_Id,onChange:()=>{return e=s.Task_Id,void ue(pe===e?null:e);var e},sx:{marginBottom:2,boxShadow:"10px black"},children:[(0,_.jsx)(O.c,{expandIcon:(0,_.jsx)(V.c,{}),children:(0,_.jsx)(R.c,{fontWeight:"bold",children:(null===s||void 0===s?void 0:s.Task_Name)||"DEFAULT TASK"})}),(0,_.jsx)(q.c,{children:(0,_.jsx)(b.c,{style:{maxHeight:"50vh"},children:(0,_.jsxs)(v.c,{stickyHeader:!0,children:[(0,_.jsx)(k.c,{style:{backgroundColor:"#2C3E50"},children:(0,_.jsxs)(S.c,{style:{backgroundColor:"#2C3E50"},children:[(0,_.jsx)(f.c,{style:{backgroundColor:"#2C3E50",color:"white"},children:"Task"}),(0,_.jsx)(f.c,{style:{backgroundColor:"#2C3E50",color:"white"},children:"Task Type"}),(0,_.jsx)(f.c,{style:{backgroundColor:"#2C3E50",color:"white"},children:"Employees"}),(0,_.jsx)(f.c,{style:{backgroundColor:"#2C3E50",color:"white"},children:"Details"})]})}),(0,_.jsxs)(S.c,{sx:{backgroundColor:"#BBE6F6"},children:[(0,_.jsx)(f.c,{children:s.Task_Name}),(0,_.jsx)(f.c,{children:e.SchType}),(0,_.jsx)(f.c,{children:Array.isArray(s.AssignedEmployees)&&s.AssignedEmployees.length>0?s.AssignedEmployees.map(((e,s)=>(0,_.jsx)(F.c,{label:e.Name,variant:"outlined",size:"small",sx:{margin:"2px",color:"green"}},s))):(0,_.jsx)("span",{children:"No Employees Assigned"})}),(0,_.jsx)(f.c,{children:(0,_.jsx)(r.c,{onClick:()=>Re(s),children:(0,_.jsx)(L.c,{})})})]},s.Task_Id)]})})})]},s.Task_Id))):(0,_.jsx)(R.c,{variant:"body2",color:"textSecondary",children:"No tasks available for this task type."})})]},s.Task_Type_Id))):(0,_.jsx)(R.c,{variant:"body2",color:"textSecondary",children:"No task type groups found for this schedule type."})})]},e.SchTypeId))):(0,_.jsx)(R.c,{variant:"body2",color:"textSecondary",children:"No schedule types available."})]},s)})):(0,_.jsx)(R.c,{variant:"body2",color:"textSecondary",children:"No overall tasks available."})})}),Array.isArray(a)&&a.map(((e,s)=>(0,_.jsxs)(te.c,{value:(e.SchTypeId||s).toString(),id:"tabpanel-".concat(e.SchTypeId||s),"aria-labelledby":"tab-".concat(e.SchTypeId||s),children:[(0,_.jsx)(E.c,{sx:{marginBottom:2,padding:2,backgroundColor:"#f9f9f9",borderRadius:"8px"},children:Array.isArray(e.TaskCountsInSchType)&&e.TaskCountsInSchType.length>0?e.TaskCountsInSchType.map(((s,a)=>(0,_.jsxs)(R.c,{variant:"body1",display:"flex",justifyContent:"space-between",alignItems:"center",children:[(0,_.jsxs)(E.c,{children:["Schedule Type: ",(0,_.jsx)("strong",{children:e.SchType})]}),(0,_.jsxs)(E.c,{textAlign:"right",children:["Total Tasks: ",(0,_.jsx)("strong",{children:s.TotalTasks})," / Completed Tasks: ",(0,_.jsx)("strong",{children:s.CompletedTasks})]})]},a))):(0,_.jsx)(R.c,{variant:"body2",color:"textSecondary",children:"No tasks counted for this schedule type."})}),Array.isArray(e.TaskTypeGroups)&&e.TaskTypeGroups.length>0?e.TaskTypeGroups.map((s=>(0,_.jsxs)(B.c,{expanded:he===s.Task_Type_Id,onChange:()=>Ee(s.Task_Type_Id),sx:{backgroundColor:"#f0f4ff",boxShadow:"black"},children:[(0,_.jsxs)(O.c,{expandIcon:(0,_.jsx)(V.c,{}),children:[(0,_.jsx)(R.c,{fontWeight:"bold",children:s.Task_Type||"Default Task Type"}),(0,_.jsx)(E.c,{sx:{textAlign:"right",flexGrow:1},children:(0,_.jsxs)(R.c,{variant:"h6",children:[(0,_.jsx)(R.c,{fontWeight:"bold",children:"Completed Task / Total Task"}),s.TaskMetrics.map(((e,s)=>(0,_.jsxs)(R.c,{sx:{textAlign:"right",flexGrow:1},children:[e.CompletedTasks," / ",null===e||void 0===e?void 0:e.TotalTasks]},s)))]})})]}),(0,_.jsx)(q.c,{children:Array.isArray(s.Tasks)&&s.Tasks.length>0?s.Tasks.map((s=>(0,_.jsxs)(B.c,{expanded:xe===s.Task_Id,onChange:()=>De(s.Task_Id),sx:{marginBottom:2},children:[(0,_.jsx)(O.c,{expandIcon:(0,_.jsx)(V.c,{}),children:(0,_.jsx)(E.c,{sx:{textAlign:"left",flexGrow:1},children:(0,_.jsx)(R.c,{fontWeight:"bold",children:(null===s||void 0===s?void 0:s.Task_Name)||"DEFAULT TASK"})})}),(0,_.jsx)(q.c,{children:(0,_.jsx)(b.c,{style:{maxHeight:"50vh"},children:(0,_.jsxs)(v.c,{stickyHeader:!0,children:[(0,_.jsx)(k.c,{style:{backgroundColor:"#2C3E50"},children:(0,_.jsxs)(S.c,{style:{backgroundColor:"#2C3E50"},children:[(0,_.jsx)(f.c,{style:{backgroundColor:"#2C3E50",color:"white"},children:"Task"}),(0,_.jsx)(f.c,{style:{backgroundColor:"#2C3E50",color:"white"},children:"Task Type"}),(0,_.jsx)(f.c,{style:{backgroundColor:"#2C3E50",color:"white"},children:"Employees"}),(0,_.jsx)(f.c,{style:{backgroundColor:"#2C3E50",color:"white"},children:"Employee Assign"}),(0,_.jsx)(f.c,{style:{backgroundColor:"#2C3E50",color:"white"},children:"Actions"}),(0,_.jsx)(f.c,{style:{backgroundColor:"#2C3E50",color:"white"},children:"Details"})]})}),(0,_.jsxs)(S.c,{sx:{backgroundColor:"#BBE6F6"},children:[(0,_.jsx)(f.c,{children:s.Task_Name}),(0,_.jsxs)(f.c,{children:[e.SchType,(0,_.jsx)(r.c,{onClick:()=>{return e=s,ge(!0),Z(e),void be(!0);var e},children:(0,_.jsx)(h.c,{})})]}),(0,_.jsx)(f.c,{children:Array.isArray(s.AssignedEmployees)&&s.AssignedEmployees.length>0?s.AssignedEmployees.map(((e,s)=>(0,_.jsx)(F.c,{label:e.Name,variant:"outlined",size:"small",sx:{margin:"2px",color:"green"}},s))):(0,_.jsx)("span",{children:"No Employees Assigned"})}),(0,_.jsx)(f.c,{children:(0,_.jsx)(r.c,{onClick:()=>(async e=>{w(e),D(!0)})(s),children:(0,_.jsx)(M.c,{})})}),1===Number(null===je||void 0===je?void 0:je.Edit_Rights)&&(0,_.jsx)(f.c,{children:(0,_.jsx)(r.c,{onClick:()=>(w(s),void ie(!0)),children:(0,_.jsx)(h.c,{})})}),(0,_.jsx)(f.c,{children:(0,_.jsx)(r.c,{onClick:()=>Re(s),children:(0,_.jsx)(L.c,{})})})]},s.Task_Id)]})})})]},s.Task_Id))):(0,_.jsx)(R.c,{variant:"body2",color:"textSecondary",children:"No tasks available for this task type."})})]},s.Task_Type_Id))):(0,_.jsx)(R.c,{variant:"body2",color:"textSecondary",children:"No task type groups found for this schedule type."})]},"".concat(e.SchTypeId||"index","-").concat(s))))]},s)}))}),(0,_.jsx)(d.c,{sx:{marginTop:"auto ",position:"sticky",bottom:0},children:(0,_.jsx)(T.c,{variant:"contained",color:"primary",onClick:async()=>{a(!1),Z({})},children:"Close"})})]}),(0,_.jsxs)(l.c,{open:I,fullWidth:!0,maxWidth:"sm",PaperProps:{style:{borderRadius:"8px"}},children:[(0,_.jsx)(c.c,{children:"Assign Task"}),(0,_.jsxs)(n.c,{children:[(0,_.jsx)("div",{style:{padding:"1px",display:"flex"},children:(0,_.jsxs)("div",{style:{flex:1,display:"flex",alignItems:"center"},children:[(0,_.jsx)("label",{htmlFor:"task-select",style:{marginRight:"8px"},children:"Select Task"}),(0,_.jsxs)("select",{id:"task-select",value:Y.Task_Id||"",className:"cus-inpt",required:!0,onChange:e=>(async e=>{Z((s=>({...s,Task_Id:e.value,TasksGet:e.label})));try{const s=await(0,x.q)({address:"taskManagement/tasks/tasklistsid?Task_Id=".concat(e.value)});if(s.success){const e=s.data;Z((s=>({...s,Task_Levl_Id:e.Task_Levl_Id,Task_Name:e.Task_Name,Task_Desc:e.Task_Desc,Task_Group_Id:e.Task_Group_Id,Sch_Type_Id:e.Sch_Type_Id,Task_Sch_Duaration:e.Task_Sch_Duaration||"",Task_Start_Time:e.Task_Start_Time||(new Date).toISOString(),Task_End_Time:e.Task_End_Time||(new Date).toISOString(),Task_Est_Start_Date:e.Task_Est_Start_Date||(new Date).toISOString(),Task_Est_End_Date:e.Task_Est_End_Date||(new Date).toISOString()})))}else p.m4.error("Failed to fetch task details")}catch(s){p.m4.error(s)}})({value:e.target.value}),style:{flex:1,marginRight:"8px"},children:[(0,_.jsx)("option",{value:"",disabled:!0,children:"- select -"}),Ae.map(((e,s)=>(0,_.jsx)("option",{value:e.value,children:e.label},s)))]}),(0,_.jsx)(r.c,{onClick:()=>g(!0),children:(0,_.jsx)(T.c,{variant:"contained",color:"primary",children:"Create New"})})]})}),(0,_.jsx)("div",{style:{padding:"1px",display:"flex"},children:(0,_.jsxs)("div",{style:{flex:1,display:"flex",alignItems:"center"},children:[(0,_.jsx)("label",{style:{marginRight:"8px"},children:"Sch_Type"}),(0,_.jsxs)("select",{value:Y.Sch_Type_Id||"",onChange:Be,className:"cus-inpt",required:!0,style:{marginLeft:"10px"},children:[(0,_.jsx)("option",{value:"",disabled:!0,children:"- Sch_Type -"}),Ie.map(((e,s)=>(0,_.jsx)("option",{value:e.Sch_Type_Id,children:e.Sch_Type},s)))]})]})})]}),(0,_.jsxs)(d.c,{children:[(0,_.jsx)(T.c,{onClick:()=>N(!1),children:"Cancel"}),(0,_.jsx)(T.c,{variant:"contained",color:"primary",onClick:async()=>{if(!Y.Task_Id||!Y.Sch_Type_Id)return void p.m4.error("Please select a task and schedule type before saving.");const e={entryBy:ne,Project_Id:o,Sch_Type_Id:Y.Sch_Type_Id,Sch_Est_Start_Date:Y.Task_Est_Start_Date,Sch_Est_End_Date:Y.Task_Est_End_Date,tasks:[Y]};try{const s=await(0,x.q)({address:"taskManagement/project/schedule/createNewTaskWithSchedule",method:"POST",bodyData:e});s.success?(p.m4.success(s.message),N(!1),Z({}),we(),m()):(s.status,p.m4.warn(s.message||"Task already exists for this project."))}catch(s){p.m4.error(s)}},children:"Save"})]})]}),(0,_.jsx)(K,{open:C,onClose:()=>D(!1),task:P,projectId:o,entryBy:ne,taskId:P,reload:m}),(0,_.jsxs)(l.c,{open:re,onClose:()=>le(!1),children:[(0,_.jsx)(c.c,{children:"Delete Task"}),(0,_.jsx)(d.c,{children:(0,_.jsx)(T.c,{onClick:()=>le(!1),color:"primary",children:"Cancel"})})]}),(0,_.jsx)(J,{openAction:j,onCloseFun:()=>g(!1),onTaskAdded:Pe,Reload:i}),(0,_.jsx)(J,{row:P,openAction:oe,onCloseFun:()=>ie(!1),reload:we}),(0,_.jsx)(ee,{open:z,onClose:()=>Q(!1),taskDetails:U})]})},le=()=>{const[e,s]=(0,t.useState)(!1),[a,y]=(0,t.useState)([]),[j,T]=(0,t.useState)([]),{contextObj:b}=(0,t.useContext)(u.a),[v,k]=(0,t.useState)(!1),[S,f]=(0,t.useState)(null),[I,N]=(0,t.useState)(!1),[C,E]=(0,t.useState)(0),[D,A]=(0,t.useState)(!1),[R,B]=(0,t.useState)(null),[O,q]=(0,t.useState)(!1),[F,M]=(0,t.useState)(!1),[L,W]=(0,t.useState)(""),G=JSON.parse(localStorage.getItem("user"));(0,t.useEffect)((()=>{H(),z()}),[null===G||void 0===G?void 0:G.Company_id,e]);const U=()=>s((e=>!e)),H=async()=>{try{const e=await(0,x.q)({address:"taskManagement/project/newProjectAbstract?Company_id=".concat(null===G||void 0===G?void 0:G.Company_id)});y(e.success?e.data:[])}catch(e){console.error(e),y([])}},z=async()=>{try{const e=await(0,x.q)({address:"taskManagement/project?Company_id=".concat(null===G||void 0===G?void 0:G.Company_id)});T(e.success?e.data:[])}catch(e){console.error(e),T([])}},J=()=>{R&&(0,x.q)({address:"taskManagement/project",method:"DELETE",bodyData:{Project_Id:null===R||void 0===R?void 0:R.Project_Id}}).then((a=>{a.success?(s(!e),p.m4.success(a.message)):p.m4.error(a.message)})).catch((e=>console.error("Fetch Error:",e))),A(!1)},V=[{name:"Project",selector:e=>e.Project_Name,sortable:!0,width:"350px"},{name:"Head",selector:e=>{var s;return null===(s=j.find((s=>s.Project_Id===e.Project_Id)))||void 0===s?void 0:s.Project_Head_Name},sortable:!0},{name:"Status",selector:e=>{var s;return null===(s=j.find((s=>s.Project_Id===e.Project_Id)))||void 0===s?void 0:s.Status},sortable:!0},{name:"End Date",selector:e=>e.Est_End_Dt?new Date(e.Est_End_Dt).toLocaleDateString("en-IN"):"N/A",sortable:!0},{name:"Progress",selector:e=>{return"".concat((s=e.TasksScheduled,a=e.CompletedTasks,0===Number(s)?0:(Number(a)/Number(s)*100).toFixed(0)),"%");var s,a},sortable:!0},{name:"Tasks",cell:e=>(0,_.jsxs)(_.Fragment,{children:[(0,_.jsx)(r.c,{onClick:()=>K(e),children:(0,_.jsx)(o.c,{})}),e.CompletedTasks," / ",e.TasksScheduled]})},{name:"Assigned",selector:e=>e.TotalTaskAssignments},{name:"Employees",cell:e=>(0,_.jsxs)(_.Fragment,{children:[1===Number(null===b||void 0===b?void 0:b.Add_Rights)&&(0,_.jsx)(r.c,{onClick:()=>$(e.Project_Id),children:(0,_.jsx)(i.c,{})}),e.EmployeesInvolved]})},{name:"Actions",cell:e=>(0,_.jsx)(_.Fragment,{children:1===Number(null===b||void 0===b?void 0:b.Edit_Rights)&&(0,_.jsx)(r.c,{onClick:()=>Y(e),children:(0,_.jsx)(h.c,{})})})}],Q=a.filter((e=>{var s,a;const t=(null===(s=j.find((s=>s.Project_Id===e.Project_Id)))||void 0===s?void 0:s.Project_Head_Name)||"",r=(null===(a=j.find((s=>s.Project_Id===e.Project_Id)))||void 0===a?void 0:a.Status)||"";return e.Project_Name.toLowerCase().includes(L.toLowerCase())||t.toLowerCase().includes(L.toLowerCase())||r.toLowerCase().includes(L.toLowerCase())})),Y=e=>{f(e),N(!0),k(!0)},K=e=>{f(e),E(e.Project_Id),M(!0)},Z=()=>{k(!1),M(!1),f(null),B(null),A(!1)},$=e=>{E(e),q(!0)};return(0,_.jsxs)(_.Fragment,{children:[(0,_.jsxs)("div",{className:"fw-bold d-flex align-items-center justify-content-between mt-0 ",children:[(0,_.jsx)("span",{style:{marginLeft:"20px"},children:"Projects"}),(0,_.jsxs)("div",{className:"mb-1",style:{display:"flex",alignItems:"center"},children:[(0,_.jsxs)("div",{style:{position:"relative",display:"flex",alignItems:"center"},children:[(0,_.jsx)(m.c,{style:{position:"absolute",left:15,color:"#aaa"}}),(0,_.jsx)("input",{type:"text",placeholder:"Search",onChange:e=>W(e.target.value),style:{paddingLeft:35,marginRight:10,margin:10,borderRadius:4,border:"1px solid black"}})]}),1===Number(null===b||void 0===b?void 0:b.Add_Rights)&&(0,_.jsx)("button",{onClick:()=>{f(null),N(!1),k(!0)},className:"btn btn-primary fa-13 shadow",children:"Create Project"})]})]}),(0,_.jsxs)("div",{className:"card-body p-0 table-container",children:[(0,_.jsx)(w.cp,{columns:V,data:Q,pagination:!0,highlightOnHover:!0,fixedHeader:!0,paginationPerPage:15,responsive:!0,persistTableHead:!0,customStyles:{headCells:{style:{fontSize:"16px",fontWeight:"bold",padding:"10px",backgroundColor:"#2c3e50",color:"#ecf0f1",position:"sticky",top:0,zIndex:2}},cells:{style:{padding:"8px",fontSize:"14px",backgroundColor:"#f9f9f9",color:"#2c3e50"}},rows:{style:{borderBottom:"1px solid #ddd"}}},style:{overflowY:"auto",maxHeight:"calc(100vh - 200px)"}}),(0,_.jsxs)(l.c,{open:D,onClose:Z,"aria-labelledby":"delete-dialog-title","aria-describedby":"delete-dialog-description",children:[(0,_.jsx)(c.c,{className:"bg-danger text-white mb-2 px-3 py-2",style:{fontSize:"18px"},children:"Confirm Deletion"}),(0,_.jsxs)(n.c,{className:"p-4",style:{fontSize:"16px"},children:["Are you sure you want to delete the project",(0,_.jsx)("span",{className:"text-primary",children:" "+(null===R||void 0===R?void 0:R.Project_Name)+" "}),"?"]}),(0,_.jsxs)(d.c,{children:[(0,_.jsx)("button",{onClick:()=>A(!1),className:"btn btn-secondary fa-13 shadow",style:{background:"#95a5a6",color:"white",borderRadius:"25px",padding:"8px 15px",cursor:"pointer"},children:"Cancel"}),(0,_.jsx)("button",{onClick:J,className:"btn btn-danger fa-13 shadow",style:{background:"#e74c3c",color:"white",borderRadius:"25px",padding:"8px 15px",cursor:"pointer"},children:"Delete"})]})]})]}),(0,_.jsx)(re,{onClose:Z,dialogOpen:F,setDialogOpen:M,isEdit:!1,parseData:G,projectid:C,onReload:U,selectedProject:S}),(0,_.jsx)(g,{open:v,onClose:Z,inputValue:S,isEdit:I,setReload:U,projectData:C}),(0,_.jsx)(P,{open:O,onClose:()=>q(!1),projectId:C,onReload:U}),(0,_.jsxs)(l.c,{open:D,onClose:Z,"aria-labelledby":"delete-dialog-title","aria-describedby":"delete-dialog-description",children:[(0,_.jsx)(c.c,{className:"bg-primary text-white mb-2 px-3 py-2",children:"Confirmation"}),(0,_.jsxs)(n.c,{className:"p-4",children:["Do you want to delete the project",(0,_.jsx)("span",{className:"text-primary",children:" "+(null===R||void 0===R?void 0:R.Project_Name)+" "}),"?"]}),(0,_.jsxs)(d.c,{children:[(0,_.jsx)("button",{onClick:()=>A(!1),className:"btn btn-secondary fa-13 shadow",children:"Cancel"}),(0,_.jsx)("button",{onClick:J,className:"btn btn-danger fa-13 shadow",children:"Delete"})]})]})]})}}}]);
//# sourceMappingURL=2744.11d27ef1.chunk.js.map